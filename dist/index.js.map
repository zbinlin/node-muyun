{"version":3,"file":null,"sources":["../index.js"],"sourcesContent":["\"use strict\";\n\nimport * as crypto from \"crypto\";\nimport * as util from \"util\";\n\nconst ALG_C = \"aes192\";\n\n\n/**\n * @param {Stream} stream\n * @return {Function<Promise<Buffer, Error>>}\n */\nfunction wrapStream(stream) {\n    return buffer => {\n        return new Promise((resolve, reject) => {\n            const buffers = [];\n            buffers.size = 0;\n            stream.on(\"data\", data => {\n                buffers.push(data);\n                buffers.size += data.length;\n            });\n            stream.on(\"end\", () => {\n                resolve(Buffer.concat(buffers, buffers.size));\n            });\n            stream.on(\"error\", reject);\n            stream.end(buffer);\n        });\n    };\n}\n\n/**\n * @param {string|Buffer} phrase\n * @param {string} salt\n * @param {string}\n */\nasync function createPasswordBy(phrase, salt) {\n    const hmac = crypto.createHmac(\"sha256\", phrase);\n    const pw = await wrapStream(hmac)(Buffer.from(String(salt), \"utf8\"));\n    return pw.toString(\"hex\");\n}\n\n\n/**\n * @param {number}\n * @param {Date|number} [timestamp=Date.now()]\n * @return {Object}\n * @property {number} interval\n * @property {number} base\n * @property {number} offset\n */\nexport function getTimeOffsetBy(interval, timestamp = Date.now()) {\n    if (timestamp instanceof Date) {\n        timestamp = Math.floor(timestamp.getTime() / 1000);\n    }\n    return timestamp % interval;\n}\n\n/**\n * @param {number} timestamp\n * @param {number} interval\n * @param {number} offset\n * @return {number}\n */\nexport function getSameValueFromTimeInterval(timestamp, interval, offset) {\n    if (timestamp instanceof Date) {\n        timestamp = Math.floor(timestamp.getTime() / 1000);\n    }\n    return Math.floor((timestamp - offset) / interval) * (interval - offset);\n}\nexport const calcPasswordFrom = util.deprecate(getSameValueFromTimeInterval, \"calcPasswordFrom was deprecated, please use getSameValueFromTimeInterval instaead.\");\n\n/**\n * @param {string} str\n * @param {string|Buffer} phrase\n * @param {string} salt\n * @return {Buffer}\n */\nexport async function encrypt(str, phrase, salt) {\n    const password = await createPasswordBy(phrase, salt);\n    const cipher = crypto.createCipher(ALG_C, password);\n    return await wrapStream(cipher)(Buffer.from(str, \"utf8\"));\n}\n\n/**\n * @param {Buffer} buffer\n * @param {string|Buffer} phrase\n * @param {string} salt\n * @return {string}\n */\nexport async function decrypt(buffer, phrase, salt) {\n    const password = await createPasswordBy(phrase, salt);\n    const decipher = crypto.createDecipher(ALG_C, password);\n    const newBuffer = await wrapStream(decipher)(buffer);\n    return newBuffer.toString(\"utf8\");\n}\n"],"names":["phrase","salt","hmac","crypto","pw","wrapStream","Buffer","from","String","toString","createPasswordBy","ALG_C","stream","buffer","Promise","resolve","reject","buffers","size","on","data","push","length","concat","end","getTimeOffsetBy","interval","timestamp","Date","now","Math","floor","getTime","getSameValueFromTimeInterval","offset","calcPasswordFrom","util","str","password","cipher","encrypt","decipher","newBuffer","decrypt"],"mappings":";;;;;;;AA8BA;;;;;;iCAKA,WAAgCA,MAAhC,EAAwCC,IAAxC,EAA8C;cACpCC,OAAOC,iBAAA,CAAkB,QAAlB,EAA4BH,MAA5B,CAAb;cACMI,KAAK,MAAMC,WAAWH,IAAX,EAAiBI,OAAOC,IAAP,CAAYC,OAAOP,IAAP,CAAZ,EAA0B,MAA1B,CAAjB,CAAjB;eACOG,GAAGK,QAAH,CAAY,KAAZ,CAAP;;;oBAHWC;;;;;;;;;;;;;;;;;AAjCf,AACA,AAEA,MAAMC,QAAQ,QAAd;;;;;;AAOA,SAASN,UAAT,CAAoBO,MAApB,EAA4B;WACjBC,UAAU;eACN,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;kBAC9BC,UAAU,EAAhB;oBACQC,IAAR,GAAe,CAAf;mBACOC,EAAP,CAAU,MAAV,EAAkBC,QAAQ;wBACdC,IAAR,CAAaD,IAAb;wBACQF,IAAR,IAAgBE,KAAKE,MAArB;aAFJ;mBAIOH,EAAP,CAAU,KAAV,EAAiB,MAAM;wBACXb,OAAOiB,MAAP,CAAcN,OAAd,EAAuBA,QAAQC,IAA/B,CAAR;aADJ;mBAGOC,EAAP,CAAU,OAAV,EAAmBH,MAAnB;mBACOQ,GAAP,CAAWX,MAAX;SAXG,CAAP;KADJ;CAqCJ,AAAO,SAASY,eAAT,CAAyBC,QAAzB,EAAmCC,YAAYC,KAAKC,GAAL,EAA/C,EAA2D;QAC1DF,qBAAqBC,IAAzB,EAA+B;oBACfE,KAAKC,KAAL,CAAWJ,UAAUK,OAAV,KAAsB,IAAjC,CAAZ;;WAEGL,YAAYD,QAAnB;;;;;;;;;AASJ,AAAO,SAASO,4BAAT,CAAsCN,SAAtC,EAAiDD,QAAjD,EAA2DQ,MAA3D,EAAmE;QAClEP,qBAAqBC,IAAzB,EAA+B;oBACfE,KAAKC,KAAL,CAAWJ,UAAUK,OAAV,KAAsB,IAAjC,CAAZ;;WAEGF,KAAKC,KAAL,CAAW,CAACJ,YAAYO,MAAb,IAAuBR,QAAlC,KAA+CA,WAAWQ,MAA1D,CAAP;;AAEJ,AAAO,MAAMC,mBAAmBC,cAAA,CAAeH,4BAAf,EAA6C,oFAA7C,CAAzB;;;;;;;;AAQP;kCAAO,WAAuBI,GAAvB,EAA4BrC,MAA5B,EAAoCC,IAApC,EAA0C;cACvCqC,WAAW,MAAM5B,iBAAiBV,MAAjB,EAAyBC,IAAzB,CAAvB;cACMsC,SAASpC,mBAAA,CAAoBQ,KAApB,EAA2B2B,QAA3B,CAAf;eACO,MAAMjC,WAAWkC,MAAX,EAAmBjC,OAAOC,IAAP,CAAY8B,GAAZ,EAAiB,MAAjB,CAAnB,CAAb;KAHJ;;oBAAsBG,OAAtB;;;;;;;;;;;AAYA;kCAAO,WAAuB3B,MAAvB,EAA+Bb,MAA/B,EAAuCC,IAAvC,EAA6C;cAC1CqC,WAAW,MAAM5B,iBAAiBV,MAAjB,EAAyBC,IAAzB,CAAvB;cACMwC,WAAWtC,qBAAA,CAAsBQ,KAAtB,EAA6B2B,QAA7B,CAAjB;cACMI,YAAY,MAAMrC,WAAWoC,QAAX,EAAqB5B,MAArB,CAAxB;eACO6B,UAAUjC,QAAV,CAAmB,MAAnB,CAAP;KAJJ;;oBAAsBkC,OAAtB;;;;;;;;;"}